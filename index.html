<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Board Pro</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
body, html {margin:0;padding:0;font-family:'Segoe UI',sans-serif;background:#111;color:#0f0;overflow-x:hidden;}
header{background:#0f0;color:#111;padding:1rem;text-align:center;font-size:1.8rem;font-weight:bold;position:sticky;top:0;z-index:50;}
nav{display:flex;justify-content:space-around;background:#222;padding:0.5rem 0;position:sticky;top:60px;z-index:40;}
nav button{padding:0.6rem 1.2rem;border:none;border-radius:6px;font-weight:bold;cursor:pointer;transition:0.3s;background:#444;color:#fff;}
nav button.active{background:#0f0;color:#111;}
section{padding:1rem;display:none;}
section.active{display:block;}
.card{background:#222;margin-bottom:1rem;padding:1rem;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,0.5);}
h2{color:#0f0;}
.carousel{overflow:hidden;white-space:nowrap;background:#000;padding:0.5rem;margin-bottom:1rem;}
.carousel span{display:inline-block;margin-right:2rem;color:#0f0;font-weight:bold;}
.news-item{margin-bottom:0.5rem;}
.news-item a{color:#0f0;text-decoration:none;}
.news-item a:hover{text-decoration:underline;}
.muted-small{color:#aaa;font-size:0.8rem;}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;}
.calendar-grid div{border:1px solid #444;min-height:80px;padding:3px;cursor:pointer;font-size:0.9rem;}
.today{background:#0f05;border-color:#0f0;}
#photoPreview img{max-width:100%; margin-top:10px;border-radius:8px;}
input,textarea,select,button{border-radius:5px;background:#222;color:#0f0;border:1px solid #555;padding:0.4rem;margin:0.2rem 0;}
button.addEntry, button.authButton{background:#0f0;color:#111;width:100%;cursor:pointer;}
button.addEntry:hover,button.authButton:hover{background:#0b0;}
</style>
</head>
<body>

<header>Trade Board Pro</header>
<nav>
  <button data-tab="accueil" class="active">Accueil</button>
  <button data-tab="actualites">Actualités</button>
  <button data-tab="strategies">Stratégies</button>
  <button data-tab="journal">Journal</button>
  <button data-tab="photos">Photos</button>
</nav>

<!-- ACCUEIL -->
<section id="accueil" class="active">
  <div class="card">
    <h2>Bienvenue</h2>
    <p>Bienvenue sur votre application de suivi de stratégies et journal de trading.</p>
    <p>"Le succès en trading vient de la discipline et de l'organisation."</p>
  </div>
  <div class="card">
    <h2>Widgets Marchés</h2>
    <div class="carousel" id="marketCarousel"></div>
    <div class="tradingview-widget-container">
      <div id="tradingview_ticker"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
      {
        "symbols":[
          {"proName":"FOREXCOM:XAUUSD","title":"Gold"},
          {"proName":"CAPITALCOM:US500","title":"S&P 500"},
          {"proName":"NASDAQ:NDX","title":"Nasdaq 100"},
          {"proName":"BITSTAMP:BTCUSD","title":"Bitcoin"},
          {"proName":"TVC:DXY","title":"US Dollar Index"}
        ],
        "colorTheme":"dark",
        "isTransparent":false,
        "displayMode":"adaptive",
        "locale":"fr"
      }
      </script>
    </div>
  </div>
  <div class="card">
    <h2>Calendrier économique</h2>
    <iframe src="https://sslecal2.investing.com?ecoDayBackground=%23111&defaultFont=Arial&innerBorderColor=%230f0&borderColor=%230f0&columns=exc_flags,date,time,event,actual,forecast,previous&countries=5,72,22,17,39,43,55,4,26,10,12,6,37,97,72&importance=1,2,3&calType=day&timeZone=48&lang=12" width="100%" height="500" frameborder="0" allowtransparency="true"></iframe>
  </div>
</section>

<!-- ACTUALITÉS -->
<section id="actualites">
  <div class="card">
    <h2>Actualités financières</h2>
    <label>Catégorie :
      <select id="newsCategory">
        <option value="general">Général</option>
        <option value="forex">Forex</option>
        <option value="crypto">Crypto</option>
        <option value="gold">Gold</option>
        <option value="bourse">Bourse</option>
      </select>
    </label>
    <div id="newsLoading" class="muted-small"></div>
    <div id="newsList"></div>
  </div>
</section>

<!-- STRATÉGIES -->
<section id="strategies">
  <div class="card">
    <h2>Stratégies</h2>
    <button onclick="addStrategy()">Ajouter une stratégie</button>
    <div id="strategyList"></div>
  </div>
</section>

<!-- JOURNAL -->
<section id="journal">
  <div class="card">
    <h2>Journal de Trading</h2>
    <div id="calendarHeader">
      <button onclick="prevMonth()">&lt;</button>
      <span id="monthYear"></span>
      <button onclick="nextMonth()">&gt;</button>
    </div>
    <div class="calendar-grid" id="calendar"></div>
  </div>
</section>

<!-- PHOTOS -->
<section id="photos">
  <div class="card">
    <h2>Mes Photos</h2>
    <input type="file" id="photoInput" accept="image/*">
    <button onclick="addPhoto()">Ajouter</button>
    <div id="photoPreview"></div>
  </div>
</section>

<script>
// NAVIGATION
const tabs=document.querySelectorAll("nav button");
tabs.forEach(btn=>{
  btn.addEventListener("click",()=>{
    tabs.forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll("section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(btn.dataset.tab).classList.add("active");
  });
});

// CARROUSEL
const marketCarousel=document.getElementById("marketCarousel");
const markets=["Gold monte","USD baisse","BTC en hausse","Nasdaq stable","S&P500 recule"];
let idx=0;
setInterval(()=>{marketCarousel.innerHTML="<span>"+markets[idx]+"</span>"; idx=(idx+1)%markets.length;},3000);

// ACTUALITÉS
const FINNHUB_KEY="d3ber21r01qqg7bua73gd3ber21r01qqg7bua740";
const NEWSAPI_KEY="c273752849e34937bf79a8bba0917602";
const newsListEl=document.getElementById("newsList");
const newsLoading=document.getElementById("newsLoading");
const newsCategory=document.getElementById("newsCategory");

function prettyDateFromUnix(unixSec){
  const d=new Date(unixSec*1000);
  const now=new Date();
  let label="";
  if(d.toDateString()===now.toDateString()) label="Aujourd'hui";
  else if(d.toDateString()===new Date(now.getTime()-86400000).toDateString()) label="Hier";
  else if(d.toDateString()===new Date(now.getTime()+86400000).toDateString()) label="Demain";
  else label=d.toLocaleDateString("fr-FR");
  return `${label} ${d.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}`;
}
function escapeHtml(str){return str.replace(/[&<>'"]/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[c]));}

async function fetchNews(category="general"){
  newsLoading.textContent="Chargement...";
  newsListEl.innerHTML="";
  try{
    let frUrl="https://newsapi.org/v2/top-headlines?country=fr&apiKey="+NEWSAPI_KEY;
    if(category!=="general") frUrl+="&q="+encodeURIComponent(category);
    const frResp=await fetch(frUrl);
    const frData=await frResp.json();
    let frArticles=frData.articles || [];

    let enUrl="https://finnhub.io/api/v1/news";
    if(category!=="general") enUrl+="?category="+encodeURIComponent(category)+"&token="+FINNHUB_KEY;
    else enUrl+="?token="+FINNHUB_KEY;
    const enResp=await fetch(enUrl);
    let enData=await enResp.json();
    if(!Array.isArray(enData)) enData=[];

    let allNews=[];
    frArticles.forEach(item=>allNews.push({title:item.title,url:item.url,timestamp:new Date(item.publishedAt).getTime()/1000,source:item.source.name}));
    enData.forEach(item=>allNews.push({title:item.headline,url:item.url,timestamp:item.datetime,source:item.source}));

    allNews.sort((a,b)=>b.timestamp-a.timestamp);
    if(allNews.length===0){ newsListEl.innerHTML="<div class='muted-small'>Aucune actualité.</div>"; return; }
    allNews.forEach(item=>{
      const div=document.createElement("div");
      div.className="news-item";
      const timeLabel=item.timestamp?prettyDateFromUnix(item.timestamp):"";
      div.innerHTML=`<a href="${item.url}" target="_blank">${escapeHtml(item.title)}</a>
        <p>${timeLabel} • <span class="muted-small">${escapeHtml(item.source||"")}</span></p>`;
      newsListEl.appendChild(div);
    });
  }catch(e){newsListEl.innerHTML="<div class='muted-small'>Erreur chargement actus</div>"; console.error(e);}
  finally{newsLoading.textContent="";}
}
newsCategory.addEventListener("change",()=>fetchNews(newsCategory.value));
fetchNews(newsCategory.value);

// STRATEGIES
function addStrategy(){
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`<input placeholder="Nom stratégie"><textarea placeholder="Conditions"></textarea><button onclick="this.parentNode.remove()">Supprimer</button>`;
  document.getElementById("strategyList").appendChild(div);
}

// JOURNAL
const monthYear=document.getElementById("monthYear");
const calendarEl=document.getElementById("calendar");
let today=new Date(),currentMonth=today.getMonth(),currentYear=today.getFullYear();
let entries={};

function renderCalendar(){
  const firstDay=new Date(currentYear,currentMonth,1).getDay();
  const daysInMonth=new Date(currentYear,currentMonth+1,0).getDate();
  monthYear.textContent=new Date(currentYear,currentMonth).toLocaleString("fr-FR",{month:"long",year:"numeric"});
  calendarEl.innerHTML="";
  for(let i=0;i<firstDay;i++){calendarEl.appendChild(document.createElement("div"));}
  for(let d=1;d<=daysInMonth;d++){
    const div=document.createElement("div");
    const dateStr=`${currentYear}-${currentMonth+1}-${d}`;
    div.textContent=d;
    if(new Date().toDateString()===new Date(currentYear,currentMonth,d).toDateString()) div.classList.add("today");
    div.addEventListener("dblclick",()=>{
      const note=prompt("Entrée journal pour "+dateStr,entries[dateStr]||"");
      if(note){entries[dateStr]=note;}
    });
    calendarEl.appendChild(div);
  }
}
function prevMonth(){currentMonth--;if(currentMonth<0){currentMonth=11;currentYear--;}renderCalendar();}
function nextMonth(){currentMonth++;if(currentMonth>11){currentMonth=0;currentYear++;}renderCalendar();}
renderCalendar();

// PHOTOS
const photoInput=document.getElementById("photoInput");
const photoPreview=document.getElementById("photoPreview");
function addPhoto(){
  const file=photoInput.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    const img=document.createElement("img");
    img.src=e.target.result;
    photoPreview.appendChild(img);
  };
  reader.readAsDataURL(file);
}
</script>

</body>
</html>
