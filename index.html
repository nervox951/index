<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trade Board Pro</title>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4;}
header { background:#1a73e8; color:#fff; padding:1rem; text-align:center; font-size:1.5rem;}
nav { display:flex; justify-content:space-around; background:#e2e2e2; padding:0.5rem 0;}
nav button { padding:0.5rem 1rem; border:none; border-radius:5px; cursor:pointer; font-weight:bold;}
nav button.active { background:#1a73e8; color:#fff;}
section { padding:1rem;}
.strategy { background:#fff; margin-bottom:1rem; padding:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
.progress-bar { height:20px; background:#ddd; border-radius:10px; overflow:hidden; margin-top:0.5rem;}
.progress-bar-inner { height:100%; background:#1a73e8; width:0%; text-align:center; color:#fff; line-height:20px; font-size:0.9rem;}
.calendar { display:grid; grid-template-columns:repeat(7, 1fr); gap:1px; background:#ccc;}
.calendar div { background:#fff; min-height:80px; padding:0.5rem; position:relative;}
.calendar div span { position:absolute; top:5px; right:5px; font-size:0.8rem; font-weight:bold;}
.entry { margin-top:1.5rem; font-size:0.8rem;}
input, textarea, select { width:100%; padding:0.3rem; margin:0.2rem 0; border-radius:4px; border:1px solid #ccc;}
button.addEntry, button.authButton { background:#1a73e8; color:#fff; padding:0.5rem; border:none; border-radius:5px; cursor:pointer; width:100%; margin-top:0.5rem;}
#authContainer { max-width:400px; margin:1rem auto; background:#fff; padding:1rem; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
</style>
</head>
<body>

<header>Trade Board Pro</header>

<div id="authContainer">
  <h2>Connexion / Inscription</h2>
  <input type="email" id="authEmail" placeholder="Adresse e-mail">
  <input type="password" id="authPassword" placeholder="Mot de passe">
  <button class="authButton" id="signUpBtn">Créer un compte</button>
  <button class="authButton" id="signInBtn">Se connecter</button>
  <button class="authButton" id="signOutBtn" style="display:none;">Se déconnecter</button>
</div>

<nav style="display:none;" id="mainNav">
  <button id="tab-strategies" class="active">Stratégies</button>
  <button id="tab-calendar">Calendrier / Journal</button>
</nav>

<section id="section-strategies" style="display:none;">
  <h2>Mes stratégies</h2>
  <div class="strategy">
    <strong>Exemple stratégie</strong>
    <div>
      <label><input type="checkbox" class="condition"> Condition 1</label><br>
      <label><input type="checkbox" class="condition"> Condition 2</label><br>
      <label><input type="checkbox" class="condition"> Condition 3</label><br>
      <div class="progress-bar"><div class="progress-bar-inner">0%</div></div>
      <button class="enterPosition" disabled>Entrer en position</button>
    </div>
  </div>
</section>

<section id="section-calendar" style="display:none;">
  <h2>Calendrier & Journal</h2>
  <div id="calendar" class="calendar"></div>
  <div id="entryForm" style="margin-top:1rem;">
    <input type="date" id="entryDate">
    <input type="text" id="entryAsset" placeholder="Actif (ex: EURUSD)">
    <select id="entryType"><option value="achat">Achat</option><option value="vente">Vente</option></select>
    <input type="number" id="entryPrice" placeholder="Prix">
    <input type="number" id="entryResult" placeholder="Résultat (gain/perte)">
    <textarea id="entryDescription" placeholder="Description"></textarea>
    <button class="addEntry">Ajouter l'entrée</button>
  </div>
</section>

<script>
// --- Firebase config ---
const firebaseConfig = {
  apiKey: "AIzaSyACFzFXKK_1EH6_PVgaQQXD3fc8mBvQRvg",
  authDomain: "perso-journaling.firebaseapp.com",
  projectId: "perso-journaling",
  storageBucket: "perso-journaling.firebasestorage.app",
  messagingSenderId: "660360215177",
  appId: "1:660360215177:web:WEBAPPID_A_REMPLACER",  // à remplacer par appId Web
  measurementId: "G-MEASUREMENTID_A_REMPLACER"      // optionnel
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// --- Auth ---
const signUpBtn = document.getElementById("signUpBtn");
const signInBtn = document.getElementById("signInBtn");
const signOutBtn = document.getElementById("signOutBtn");
const authContainer = document.getElementById("authContainer");
const mainNav = document.getElementById("mainNav");

signUpBtn.addEventListener("click", ()=>{
  const email = document.getElementById("authEmail").value;
  const password = document.getElementById("authPassword").value;
  auth.createUserWithEmailAndPassword(email, password)
  .then(()=>alert("Compte créé !"))
  .catch(err=>alert(err.message));
});

signInBtn.addEventListener("click", ()=>{
  const email = document.getElementById("authEmail").value;
  const password = document.getElementById("authPassword").value;
  auth.signInWithEmailAndPassword(email, password)
  .catch(err=>alert(err.message));
});

signOutBtn.addEventListener("click", ()=>{
  auth.signOut();
});

auth.onAuthStateChanged(user=>{
  if(user){
    authContainer.style.display="none";
    mainNav.style.display="flex";
    document.getElementById("section-strategies").style.display="block";
    document.getElementById("section-calendar").style.display="none";
    signOutBtn.style.display="block";
  }else{
    authContainer.style.display="block";
    mainNav.style.display="none";
    signOutBtn.style.display="none";
    document.getElementById("section-strategies").style.display="none";
    document.getElementById("section-calendar").style.display="none";
  }
});

// --- Tab navigation ---
const tabStrategies = document.getElementById("tab-strategies");
const tabCalendar = document.getElementById("tab-calendar");
const sectionStrategies = document.getElementById("section-strategies");
const sectionCalendar = document.getElementById("section-calendar");

tabStrategies.addEventListener("click", ()=>{
  tabStrategies.classList.add("active");
  tabCalendar.classList.remove("active");
  sectionStrategies.style.display="block";
  sectionCalendar.style.display="none";
});
tabCalendar.addEventListener("click", ()=>{
  tabCalendar.classList.add("active");
  tabStrategies.classList.remove("active");
  sectionCalendar.style.display="block";
  sectionStrategies.style.display="none";
});

// --- Strategy progress ---
document.querySelectorAll(".strategy").forEach(strat=>{
  const checkboxes = strat.querySelectorAll(".condition");
  const progress = strat.querySelector(".progress-bar-inner");
  const btn = strat.querySelector(".enterPosition");
  checkboxes.forEach(cb=>{
    cb.addEventListener("change", ()=>{
      const total = checkboxes.length;
      const checked = strat.querySelectorAll(".condition:checked").length;
      const percent = Math.round(checked/total*100);
      progress.style.width = percent+"%";
      progress.textContent = percent+"%";
      btn.disabled = (checked!==total);
    });
  });
});

// --- Calendar ---
const calendarEl = document.getElementById("calendar");
let entries = {}; // { '2025-09-25': [{asset,type,price,result,desc}, ...] }

function renderCalendar(month=new Date().getMonth(), year=new Date().getFullYear()){
  calendarEl.innerHTML="";
  const firstDay = new Date(year, month, 1).getDay();
  const lastDate = new Date(year, month+1, 0).getDate();
  for(let i=0;i<firstDay;i++){calendarEl.appendChild(document.createElement("div"));}
  for(let d=1;d<=lastDate;d++){
    const day = new Date(year, month, d);
    const div = document.createElement("div");
    div.innerHTML = `<span>${d}</span>`;
    const key = day.toISOString().slice(0,10);
    if(entries[key]){
      entries[key].forEach(e=>{
        const entryDiv = document.createElement("div");
        entryDiv.className="entry";
        entryDiv.textContent=`${e.asset} ${e.type} ${e.result>0?"+":"-"}${e.result}`;
        div.appendChild(entryDiv);
      });
    }
    calendarEl.appendChild(div);
  }
}
renderCalendar();

// --- Add calendar entry ---
document.querySelector(".addEntry").addEventListener("click", ()=>{
  const date = document.getElementById("entryDate").value;
  if(!date) return alert("Choisis une date");
  const asset = document.getElementById("entryAsset").value;
  const type = document.getElementById("entryType").value;
  const price = parseFloat(document.getElementById("entryPrice").value);
  const result = parseFloat(document.getElementById("entryResult").value);
  const desc = document.getElementById("entryDescription").value;
  const user = auth.currentUser;
  if(!user) return alert("Connecte-toi d'abord");
  if(!entries[date]) entries[date]=[];
  entries[date].push({asset,type,price,result,desc});
  renderCalendar();
  // Save to Firestore
  db.collection("users").doc(user.uid).collection("journal").add({
    date, asset, type, price, result, desc, userId:user.uid
  });
  // Clear inputs
  document.getElementById("entryAsset").value="";
  document.getElementById("entryPrice").value="";
  document.getElementById("entryResult").value="";
  document.getElementById("entryDescription").value="";
});
</script>

</body>
</html>
